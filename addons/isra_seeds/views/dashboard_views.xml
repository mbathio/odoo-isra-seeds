<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Vue Tableau de Bord Principal -->
        <record id="view_seed_dashboard" model="ir.ui.view">
            <field name="name">seed.dashboard</field>
            <field name="model">seed.lot</field>
            <field name="arch" type="xml">
                <form string="Tableau de Bord - Tra√ßabilit√© des Semences" create="false" edit="false">
                    <sheet>
                        <div class="o_dashboard">
                            <h1 class="text-center mb-4">üåæ Tableau de Bord - Tra√ßabilit√© des Semences</h1>
                            
                            <!-- Statistiques G√©n√©rales -->
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="card bg-primary text-white">
                                        <div class="card-body text-center">
                                            <h2 class="card-title">
                                                <i class="fa fa-seedling"/>
                                            </h2>
                                            <h4 id="total_lots">-</h4>
                                            <p>Lots de Semences</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card bg-success text-white">
                                        <div class="card-body text-center">
                                            <h2 class="card-title">
                                                <i class="fa fa-leaf"/>
                                            </h2>
                                            <h4 id="total_varieties">-</h4>
                                            <p>Vari√©t√©s</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card bg-info text-white">
                                        <div class="card-body text-center">
                                            <h2 class="card-title">
                                                <i class="fa fa-users"/>
                                            </h2>
                                            <h4 id="total_multipliers">-</h4>
                                            <p>Multiplicateurs</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card bg-warning text-white">
                                        <div class="card-body text-center">
                                            <h2 class="card-title">
                                                <i class="fa fa-clipboard-check"/>
                                            </h2>
                                            <h4 id="total_qc">-</h4>
                                            <p>Contr√¥les Qualit√©</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Graphiques et Analyses -->
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5>Distribution par Niveau de Semence</h5>
                                        </div>
                                        <div class="card-body">
                                            <canvas id="levelChart" width="400" height="200"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5>Taux de R√©ussite Contr√¥les Qualit√©</h5>
                                        </div>
                                        <div class="card-body">
                                            <canvas id="qualityChart" width="400" height="200"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Alertes et Actions Rapides -->
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <div class="card border-warning">
                                        <div class="card-header bg-warning text-dark">
                                            <h5><i class="fa fa-exclamation-triangle"/> Alertes</h5>
                                        </div>
                                        <div class="card-body">
                                            <div id="alerts-container">
                                                <div class="alert alert-warning" role="alert">
                                                    <strong>Lots expirant bient√¥t:</strong> <span id="expiring_lots">-</span>
                                                </div>
                                                <div class="alert alert-danger" role="alert">
                                                    <strong>Contr√¥les qualit√© √©chou√©s:</strong> <span id="failed_qc">-</span>
                                                </div>
                                                <div class="alert alert-info" role="alert">
                                                    <strong>Productions en cours:</strong> <span id="active_productions">-</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card border-primary">
                                        <div class="card-header bg-primary text-white">
                                            <h5><i class="fa fa-rocket"/> Actions Rapides</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="d-grid gap-2">
                                                <button type="button" class="btn btn-primary" onclick="window.location.href='/web#action=isra_seeds.action_seed_lot&amp;view_type=form'">
                                                    <i class="fa fa-plus"/> Nouveau Lot
                                                </button>
                                                <button type="button" class="btn btn-success" onclick="window.location.href='/web#action=isra_seeds.action_quality_control&amp;view_type=form'">
                                                    <i class="fa fa-clipboard-check"/> Nouveau Contr√¥le
                                                </button>
                                                <button type="button" class="btn btn-info" onclick="window.location.href='/web#action=isra_seeds.action_production&amp;view_type=form'">
                                                    <i class="fa fa-industry"/> Nouvelle Production
                                                </button>
                                                <button type="button" class="btn btn-warning" onclick="window.location.href='/web#action=isra_seeds.action_multiplier&amp;view_type=form'">
                                                    <i class="fa fa-user-plus"/> Nouveau Multiplicateur
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Lots R√©cents -->
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5><i class="fa fa-clock"/> Lots R√©cents</h5>
                                        </div>
                                        <div class="card-body">
                                            <table class="table table-striped" id="recent-lots-table">
                                                <thead>
                                                    <tr>
                                                        <th>R√©f√©rence</th>
                                                        <th>Vari√©t√©</th>
                                                        <th>Niveau</th>
                                                        <th>Quantit√©</th>
                                                        <th>Statut</th>
                                                        <th>Date Production</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="recent-lots-body">
                                                    <!-- Charg√© dynamiquement -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Action Tableau de Bord -->
        <record id="action_seed_dashboard" model="ir.actions.act_window">
            <field name="name">Tableau de Bord</field>
            <field name="res_model">seed.lot</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_seed_dashboard"/>
            <field name="target">current</field>
            <field name="context">{'dashboard_mode': True}</field>
        </record>

        <!-- Vue Rapport Tra√ßabilit√© -->
        <record id="view_traceability_report" model="ir.ui.view">
            <field name="name">seed.traceability.report</field>
            <field name="model">seed.lot</field>
            <field name="arch" type="xml">
                <form string="Rapport de Tra√ßabilit√©" create="false" edit="false">
                    <sheet>
                        <div class="text-center mb-4">
                            <h1>üìã Rapport de Tra√ßabilit√©</h1>
                            <h3><field name="display_name" readonly="1"/></h3>
                        </div>
                        
                        <!-- Informations G√©n√©rales -->
                        <group string="Informations G√©n√©rales">
                            <group>
                                <field name="name" readonly="1"/>
                                <field name="variety_id" readonly="1"/>
                                <field name="level" readonly="1"/>
                                <field name="quantity" readonly="1"/>
                            </group>
                            <group>
                                <field name="production_date" readonly="1"/>
                                <field name="expiry_date" readonly="1"/>
                                <field name="status" readonly="1"/>
                                <field name="multiplier_id" readonly="1"/>
                            </group>
                        </group>
                        
                        <!-- QR Code -->
                        <group string="Identification">
                            <field name="qr_code_image" widget="image" readonly="1"/>
                        </group>
                        
                        <!-- G√©n√©alogie -->
                        <group string="G√©n√©alogie" attrs="{'invisible': [('parent_lot_id', '=', False), ('child_lot_ids', '=', [])]}">
                            <field name="parent_lot_id" readonly="1"/>
                            <field name="child_lot_ids" readonly="1">
                                <tree>
                                    <field name="name"/>
                                    <field name="level"/>
                                    <field name="quantity"/>
                                    <field name="status"/>
                                </tree>
                            </field>
                        </group>
                        
                        <!-- Contr√¥les Qualit√© -->
                        <group string="Historique des Contr√¥les Qualit√©">
                            <field name="quality_control_ids" readonly="1">
                                <tree>
                                    <field name="name"/>
                                    <field name="control_date"/>
                                    <field name="germination_rate"/>
                                    <field name="variety_purity"/>
                                    <field name="result"/>
                                    <field name="inspector_id"/>
                                </tree>
                            </field>
                        </group>
                        
                        <!-- Productions -->
                        <group string="Historique des Productions">
                            <field name="production_ids" readonly="1">
                                <tree>
                                    <field name="name"/>
                                    <field name="multiplier_id"/>
                                    <field name="start_date"/>
                                    <field name="actual_yield"/>
                                    <field name="status"/>
                                </tree>
                            </field>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Action Rapport Tra√ßabilit√© -->
        <record id="action_traceability_report" model="ir.actions.act_window">
            <field name="name">Rapport de Tra√ßabilit√©</field>
            <field name="res_model">seed.lot</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_traceability_report"/>
            <field name="target">new</field>
        </record>

        <!-- Vue Analyse Rendements -->
        <record id="view_yield_analysis" model="ir.ui.view">
            <field name="name">seed.yield.analysis</field>
            <field name="model">seed.production</field>
            <field name="arch" type="xml">
                <graph string="Analyse des Rendements" type="bar">
                    <field name="multiplier_id"/>
                    <field name="yield_per_hectare" type="measure"/>
                    <field name="actual_yield" type="measure"/>
                </graph>
            </field>
        </record>

        <!-- Action Analyse Rendements -->
        <record id="action_yield_analysis" model="ir.actions.act_window">
            <field name="name">Analyse des Rendements</field>
            <field name="res_model">seed.production</field>
            <field name="view_mode">graph,pivot</field>
            <field name="view_id" ref="view_yield_analysis"/>
            <field name="domain">[('status', '=', 'completed')]</field>
        </record>

        <!-- Vue Analyse Qualit√© -->
        <record id="view_quality_analysis" model="ir.ui.view">
            <field name="name">seed.quality.analysis</field>
            <field name="model">seed.quality.control</field>
            <field name="arch" type="xml">
                <graph string="Analyse Qualit√©" type="line">
                    <field name="control_date" interval="month"/>
                    <field name="germination_rate" type="measure"/>
                    <field name="variety_purity" type="measure"/>
                </graph>
            </field>
        </record>

        <!-- Action Analyse Qualit√© -->
        <record id="action_quality_analysis" model="ir.actions.act_window">
            <field name="name">Analyse Qualit√©</field>
            <field name="res_model">seed.quality.control</field>
            <field name="view_mode">graph,pivot</field>
            <field name="view_id" ref="view_quality_analysis"/>
        </record>

        <button type="button" class="btn btn-primary" onclick="window.open('/web#action=isra_seeds.action_seed_lot&amp;view_type=form', '_self')">
                                            <i class="fa fa-plus"/> Nouveau Lot
                                        </button>
                                        <button type="button" class="btn btn-success" onclick="window.open('/web#action=isra_seeds.action_quality_control&amp;view_type=form', '_self')">
                                            <i class="fa fa-clipboard-check"/> Nouveau Contr√¥le
                                        </button>
                                        <button type="button" class="btn btn-info" onclick="window.open('/web#action=isra_seeds.action_production&amp;view_type=form', '_self')">
                                            <i class="fa fa-industry"/> Nouvelle Production
                                        </button>
                                        <button type="button" class="btn btn-warning" onclick="window.open('/web#action=isra_seeds.action_multiplier&amp;view_type=form', '_self')">
                                            <i class="fa fa-user-plus"/> Nouveau Multiplicateur
                                        </button>

    </data>
</odoo>